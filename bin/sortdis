#!/usr/bin/env python3

import argparse
import fileinput

parser = argparse.ArgumentParser(
    description = 'Sort objdump disassembly output to aid comparison')
parser.add_argument('--filter-gc', help='Include only GC relevant functions')
args = parser.parse_args();

section = None
sections = []

for line in fileinput.input():
    line = line.rstrip()

    if line == "":
        section = None
        continue

    if section is None:
        section = []
        sections.append(section)

    section.append(line)

sections.sort(key = lambda s: s[0].partition(" ")[2])

for section in sections:
    # Hack to filter sections to GC-relevant parts.
    line = section[0].lower()

    if args.filter_gc and ("js::gc::" not in line and \
                           "trace" not in line and \
                           "mark" not in line and \
                           "create" not in line and \
                           "alloc" not in line):
        continue

    for line in section:
        print(line)
    print()
