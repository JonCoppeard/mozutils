#!/usr/bin/env python3
# -*- coding: utf-8 -*-

# jsbuild: Build SpiderMonkey

import argparse
import os.path
import sys

# Import common functions
sys.path.append(os.path.join(os.path.dirname(__file__), '..', 'lib'))
from mozutils import *
from mozconfig import *

parser = argparse.ArgumentParser(description = 'Build SpiderMonkey')
parser.add_argument('-n', '--dry-run', action='store_true',
                    help="Dry run: check arguments but don't build")
add_build_arguments(parser)
add_shell_config_arguments(parser)

args = parser.parse_args()

if not args.unified and not args.sync:
    sys.exit("Disabling of unifed build only supported with sync")

enter_dirs(args.dirs)

chdir_to_source_root()

if args.remote and not args.ignore_remote:
    sys.exit(run_remote_command(args))

if args.dry_run:
    quit()

args.shell = True
mach_build(args)
ensure_js_src_links(args)
